{% extends "returns/base.html" %}

{% block title %}Your articles &mdash; Returns Portal{% endblock %}

{% block content %}
<div class="order-header">
    <h1>Order {{ order.order_number }}</h1>
    <div class="order-meta">
        <span>{{ order.recipient }}</span>
        <span>{{ order.city }}</span>
        <span>Delivered {{ order.delivery_date|date:"M d, Y" }}</span>
    </div>
</div>

<h2>Articles</h2>

<form
    id="return-selection-form"
    x-data="{ selected: {}, hasSelection() { return Object.values(this.selected).some(Boolean); } }"
>
    {% for row in article_rows %}
    <div class="article-card{% if not row.selectable %} article-card-muted{% endif %}">
        <div class="article-selector">
            <input
                type="checkbox"
                id="item-{{ forloop.counter }}"
                class="item-checkbox"
                {% if row.selectable %}
                    x-model="selected['item_{{ forloop.counter }}']"
                {% else %}
                    disabled
                {% endif %}
            >
        </div>

        <div class="article-info">
            <label for="item-{{ forloop.counter }}" class="article-name article-name-label">
                {{ row.result.article.name }}
            </label>
            <div class="article-meta">
                SKU: {{ row.result.article.sku }}
                &middot; Qty: {{ row.result.article.quantity }}
                {% if row.result.article.quantity_returned > 0 %}
                    ({{ row.result.article.quantity_returned }} returned)
                {% endif %}
            </div>
            {% if not row.selectable %}
            <div class="help-text mt-1">
                {% if not row.result.returnable and row.result.reason %}
                    {{ row.result.reason }}
                {% else %}
                    Not selectable for return.
                {% endif %}
            </div>
            {% endif %}
        </div>

        <div class="article-actions">
            <label for="qty-{{ forloop.counter }}" class="qty-label">Return qty</label>
            <select
                id="qty-{{ forloop.counter }}"
                name="quantity_{{ row.result.article.sku }}"
                class="qty-select"
                {% if row.selectable %}
                    :disabled="!selected['item_{{ forloop.counter }}']"
                {% else %}
                    disabled
                {% endif %}
            >
                {% for qty in row.quantity_options %}
                <option value="{{ qty }}">{{ qty }}</option>
                {% endfor %}
            </select>
        </div>

        <div class="article-price">&euro;{{ row.result.article.price }}</div>
    </div>
    {% endfor %}

    <div class="selection-actions mt-2">
        <a href="{% url 'lookup' %}" class="btn btn-secondary">&larr; Back to lookup</a>
        <button
            id="continue-btn"
            type="button"
            class="btn btn-primary continue-btn"
            :disabled="!hasSelection()"
            disabled
        >
            Continue
        </button>
    </div>
</form>

{% endblock %}
